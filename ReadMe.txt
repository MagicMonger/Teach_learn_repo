ReadMe
V 1.0
10/04/2025

К нам обратился магазин "В один клик" за помощью в удержании клиентов. Магазин занимается различными бытовыми и электронными товарами. В последнее время снизилась активность клиентов. Клиент уже проделал определенную работу, промаркировал клиентов классами покупательской активности, Не изменилось, Снизилась. Это очень хорошо и поможет нам в работе.

Наша задача состояла в том, чтобы из полученных данных построить модель, которая бы предсказывала статус клиента в течение трех месяцев, будет ли у клиента оставаться интерес к компании или же он начнет снижаться и компания рискует потерять клиента вовсе.

Проделана следующая работа:

- *После общего осмотра данных*, мы произвели их обработку. Датафреймы содержали незначительные артефакты, как наличие разделителя и точек в десятичных значениях. Изменены некоторые типы данных object в столбце Прибыль, на float. Произведен поиск дубликатов и пустых значений, коих не было обнаружено. Названия столбцов заменены на более удобные для обработки, введены нижние подчеркивания. В некоторых столбцах были схожие названия статусов типа сервиса и периодов. Было найден один выброс в столбце Выручка, в 106862.2 рублей, что сразу заменено на медианное по столбцу;

- *Статистическое исследование*. Для каждого столбца каждого датафрейма были найдены среднее, медиана, дисперсия, стандартное отклонение, межквартильный размах, минимальные и максимальные значения, их разность. Построены графики, диаграммы размаха (в почти каждом столбце были найдены аномальные значения), гистограммы для количественных признаков, столбчатые диаграммы для категориальных признаков. Один из столбцов в датафрейме имеет высокую дисперсию, большой разброс и разнородность данных. Большая часть, наоборот, имеет низкую дисперсию;

- *Корреляционный анализ*. Построена матрица корреляции Спирмана и Фи корреляции. Имеются положительные корреляции- Маркет актив 6 мес довольно неплохо коррелирует со Страниц за визит и со временем проведенным на сайте. Акционные покупки с Неоплаченными продуктами. Средний просмотр категорий со страницами за визит. Хорошая корреляция у Страниц за визит со временем на сайте - 0.45. Отрицательные корреляции -Маркет актив 6 мес с акционными покупками. Акционные покупки со Страницами за визит и временем на сайте У Среднего просмотра категорий с Неоплаченными продуктами. Тоже самое можно сказать и про категории, неплохо связаны Популярная категория с Покупательской активностью а Разрешить сообщать с Типом сервиса. Ровно как и потратил в целом время на сайт. На графике Акционные_покупки-Страниц_за_визит видно деление на два сегмента. Часть находится в диапазоне от 0 доя 0.4 покупок, просматривая при этом до 20 страниц, а вторая чатсь находится от 0.9 до 1 покупки, просматривая до 15 покупок. Количество пользователей, тех, чья активность снизилась находятся в нижней части графика, они просматривают меньше страниц.Отличается график Акционные_покупки-Маркет_актив6мес. Имеется так же два провала, но при этом активность маркетинга до 2.5 отсутствует. Начинается от примерно 3. Мультиколлинеарностью называют наличие коофицента корреляции в диапазоне от 0.95 до 1. При таких значениях матрицы признаков могут стать вырожденными, и тогда у системы линейных уравнений не будет одного решения. В датасете отсутствует мультиколлинеарность. У нас максимальные значения корреляции это 0.3-0.4;

- Объединение всех датафреймов в один.

Следующий шаг - *создание пайплайнов* и поиск лучшей модели.

Был построен пайплайн, и произведен поиск среди четырех моделей. Целевой признак Покупательская активность. Остальные признаки входные.

На вход пайплана подавались следующие модели и диапазоны их параметров:
- KNeighborsClassifier(n_neighbors=range(1, 7));
- DecisionTreeClassifier(max_depth=range(2, 6), max_features=range(2, 5));
- LogisticRegression(random_state=RANDOM_STATE, solver='liblinear', penalty='l1');
- SVC(kernel='poly', random_state=RANDOM_STATE).

Разбиты на группы признаки, собраны в словари: ohe, ord, num. Для каждого обработчика своя категория.

Кодировка в пайплайне осуществлялась с помощью двух кодировщиков: OneHotEncoder и OrdinalEncoder. Первый задействован для кодировки бинарных значений, имеющих в столбцах всего по два строковых значения. Второй был примененм к столбцу Категория товаров. Так как категорий там 6, этот кодировщик лучше подходит.

Масштабирование в пайплайне сделано с помощью двух скэйлеров: StandartScaler() и MinMaxScaler(). Количественных признаков всего два.

В целом, в пайплане проделана следующая работа:
 - Присвоение целевого и входных признаков переменным у и Х;
 - Разбитие датафрейма на 4 выборки, входная тренировочная, входная тестовая, целевая тренировочная, целевая тестовая;
 - Кодирование категориальных признаков;
 - Масштабирование количественных;
 - Сборка столбцов и обработчиков с помощью трансформатора ColumnTransformer;
 - Создание итогового пайплана, куда включаются предподготовительные данные и трансформатор;

Затем мы осуществили поиск лучшей модели с помощью RandomizedSearchCV(). 
Лучшей моделью оказалась LogisticRegression(random_state=RANDOM_STATE, solver='liblinear', penalty='l1', С=4).

С помощью метрик мы определили следующую точность модели:

Метрика precision на тестовой выборке: 90%
Метрика recall на тестовой выборке: 95%
Метрика accuracy на тестовой выборке: 90%

Самый большой результат показала метрика recall.

Модель была обучена на тестовых данных.

Последним шагом в данном разделе было прогнозирование на реальном датасете. Выявлены пользователи с потенциальными статусами в течение трех месяцев. Мы добавили еще один столбцев в датафрейм, куда добавили спрогнозированные данные.

В *анализе важности признаков*, использовались значения Шепли, оценка которых производилась с помощью метода SHAP. Мы использовали три различных графика, каждый из которых показывал определенную сторону вклада признаков. Везде рассматривали 5ый объект. На первой диаграмме видно, что Страниц за визит, Средний просмотро категорий за визит и время на сайте являются наиболее весомыми в определеннии прогноза модели. Длинные хвосты влево и вправо говорят нам о том, что признак склоняет модель отнести объект как к классу 0 так и к 1. У одного из признаков эти хвосты длиннее чем правые. Между тем, сами линии достаточно толстые, это значит что сгруппировано очень много наблюдений в конкретном признаке. У признака Страниц за визит в левом хвосте очень красные точки, это значит что сам признак больше по оси Х.

Интересный признак Акционные покупки, его красные точки расположены справа, почти у края значения 2. Больше половины всех значений этого признака отнесены к первому классу. Неоплаченные продукты штук квартал имеет тоже много значений отнесенных к классу 1 чем к классу 0.

Теперь второй график, показывающий индивидуальные SHAP-значения каждого наблюдения.

Самое большое влияние на классификацию оказывает признак Средний просмотр категорий за визит. Он перетягивает предсказание в сторону класса 1. Лишь небольшое количество положительных значений у Маркет актив 6 мес, Акционные покупки и Выручка склоняют к 0.

На третьем графике показывается общий вклад признаков.Как и в первом графике, Страниц за визит, Средний просмотр категорий за визит и время на сайте имеют самый весомый вклад в предсказание. На втором месте Неоплаченные продукты, Акционные покупки и Маркет актив.

Не имеют влияния на прогнозирование такие признаки как Тип Сервиса, Разрешение сообщать.

В *финальном шаге сегментации пользователей*, мы добавили четвертый датасет к общему.
Выделили сегмент пользователей с прибылью выше 3 и вероятностью снижения выше 0.7.
Произвели выбор группы, которая имела наибольшую прибыль и имела самой большой потенциал к снижению интереса к сайту. Таких пользователей набралось 310, или 23% от всех 1297.
За основу группы был взят признак Страниц_за_визит
Составили графики по данной группе пользователей, и выяснили, что Страниц_за_визит сильно коррелирует с Категорий за визит. Линейные графики практически идентичны. 
Сопоставили этот признак с остальными - получились практически идентичные графики во всем. От частоты до амплитуды.
Оказалось, что количество пользователей которые склонны покинуть сайт является 96%. Что очень много.
Затем, мы произвели поиск категорий товаров, изучив поведение прибыльной группы на сайте. Количество категорий товаров в среднем равно двум. Для этой группы пользователей предпчтительнее всего товары для детей и косметика и аксессуары. И их совсем не интересует электроника и бытовые приборы.

*Сформировали предложение для компании*, как удержать эту категорию пользователей. 
Данная категория пользователей является самой прибыльной, и их интересует конкретная группа товаров. Они просматривает не больше 2 категорий товаров за визит. Значит они знают что хотят и заранее идут на интересующие их позиции товаров. Для удержания этой группы пользователей необходимо расширить ассортимент интересующих их товаров, ввести скидки. Возможно остальные группы, приносящие меньший доход фирме предпочитают другие товары, но это уже зависит от выбранной стратегии, на какой группе нужно сконцентрировать внимание.

Добавим так же, что для удержания определенной группы пользователей, нужно создать целую маркетинговую стратегию. Невозможно использовать одни и те же методы для всех сегментов пользователей. У пользователей разный доход, разное образование, разное мышление, разный подход к потреблению и выбору товаров. Есть пользователи которые берут дешевые товары на последние деньги и есть другая крайняя категория - те, кто покупает ради покупки. Поэтому крайне важно досконально знать каждый сегмент своих клиентов. 

Возможно, стоит добавить больше признаков, таких как: 
- Оценка срока доставки товара;
- Были ли возвраты товара и как часто у каждого клиента;
- Оценка стоимости товаров, что очень сильно влияет на выручку;

У компании не все потеряно, но первые звоночки уже есть, и над этим необходимо усиленно работать. В первую очередь усилить рекламный нажим на конкретные группы пользователей.